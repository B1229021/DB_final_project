<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å€‹äººæª”æ¡ˆ - {{ user.username }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">

        <!-- é é¢å°èˆªæŒ‰éˆ• -->
        <div style="margin-bottom: 16px;">
            <a href="{{ url_for('index', uid=uid) }}" class="nav-button">å›åˆ°é¦–é </a>
            <a href="{{ url_for('profile', uid=uid) }}" class="nav-button">å›åˆ°æˆ‘çš„å€‹äººé </a>
        </div>

        <div class="profile-info">
            <h1>ä½¿ç”¨è€…å€‹äººè³‡æ–™</h1>
            {% if canEdit %}
                <div id="view-mode">
                    <p><strong>æš±ç¨±ï¼š</strong> {{ user.username }}</p>
                    <p><strong>çœŸå¯¦å§“åï¼š</strong> {{ user.name }}</p>
                    <p><strong>æ€§åˆ¥ï¼š</strong> {{ user.gender }}</p>
                    <p><strong>ç”Ÿæ—¥ï¼š</strong> {{ user.birthday }}</p>
                    <p><strong>é›»è©±ï¼š</strong> {{ user.phone }}</p>
                    <p><strong>è‡ªæˆ‘ä»‹ç´¹ï¼š</strong> {{ user.self_introduction or 'å°šæœªå¡«å¯«' }}</p>
                    <button class="edit-button" onclick="toggleEdit()">âœï¸ ç·¨è¼¯å€‹è³‡</button>
                </div>
            {% else %}
                <p><strong>æš±ç¨±ï¼š</strong> {{ user.username }}</p>
                <p><strong>æ€§åˆ¥ï¼š</strong> {{ user.gender or 'æœªå¡«å¯«' }}</p>
                <p><strong>è‡ªæˆ‘ä»‹ç´¹ï¼š</strong> {{ user.self_introduction or 'å°šæœªå¡«å¯«' }}</p>
            {% endif %}

            {% if canEdit %}
            <form id="edit-mode" method="post" style="display:none;">
                <div class="form-group">
                    <label for="username">æš±ç¨±</label>
                    <input type="text" name="username" id="username" value="{{ user.username }}">
                </div>
                <div class="form-group">
                    <label for="name">çœŸå¯¦å§“å</label>
                    <input type="text" name="name" id="name" value="{{ user.name }}">
                </div>
                <div class="form-group">
                    <label for="gender">æ€§åˆ¥</label>
                    <select name="gender" id="gender">
                        <option value="ç”·" {% if user.gender == 'ç”·' %}selected{% endif %}>ç”·</option>
                        <option value="å¥³" {% if user.gender == 'å¥³' %}selected{% endif %}>å¥³</option>
                        <option value="å…¶ä»–" {% if user.gender == 'å…¶ä»–' %}selected{% endif %}>å…¶ä»–</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="birthday">ç”Ÿæ—¥</label>
                    <input type="date" name="birthday" id="birthday" value="{{ user.birthday }}">
                </div>
                <div class="form-group">
                    <label for="phone">é›»è©±</label>
                    <input type="text" name="phone" id="phone" value="{{ user.phone }}">
                </div>
                <div class="form-group">
                    <label for="self_introduction">è‡ªæˆ‘ä»‹ç´¹</label>
                    <textarea name="self_introduction" id="self_introduction">{{ user.self_introduction }}</textarea>
                </div>
                <button type="submit" class="edit-button">å„²å­˜</button>
                <button type="button" onclick="toggleEdit()" class="cancel-button">å–æ¶ˆ</button>
            </form>
            {% endif %}
        </div>

        <h2>æˆ‘ç™¼èµ·çš„æ´»å‹•</h2>
        <div class="event-card">
        {% for row in created_events %}
            <div>
                <h3>{{ row.event_name }}</h3>
                <p>åœ°é»ï¼š{{ row.location }}</p>
                <p>é–‹å§‹æ™‚é–“ï¼š{{ row.start_time }}</p>
                <p>å‚™è¨»ï¼š{{ row.annotation }}</p>
                <p>ç‹€æ…‹ï¼š{{ row.state }}</p>
            </div>
        {% endfor %}
        </div>

        <h2>æˆ‘åƒåŠ çš„æ´»å‹•</h2>
        <div class="event-card">
        {% for row in joined_events %}
            <div>
                <h3>
                    {{ row.event_name }}ï¼ˆä¸»æªï¼š
                    <a href="{{ url_for('profile', uid=uid, other_uid=row.booker) }}" style="color: lightblue;">
                        {{ row.booker_username }}
                    </a>ï¼‰
                </h3>
                <p>åœ°é»ï¼š{{ row.location }}</p>
                <p>é–‹å§‹æ™‚é–“ï¼š{{ row.start_time }}</p>
                <p>ä¸»æªè©•åƒ¹ï¼š{{ row.eval_to_booker or 'æœªå¡«å¯«' }}</p>
                <p>å°æˆ‘è©•åƒ¹ï¼š{{ row.booker_eval or 'æœªå¡«å¯«' }}</p>
                <p>æ•´é«”è©•åƒ¹ï¼š
                {% if row.evaluation is none %}
                    æœªè©•åƒ¹
                {% elif row.evaluation == 1 %}
                    ğŸ‘
                {% elif row.evaluation == -1 %}
                    ğŸ‘
                {% endif %}
                </p>
            </div>
        {% endfor %}
        </div>

        <h2>è©•åƒ¹çµ±è¨ˆ</h2>
        <div class="stat-box">
            <p><strong>ğŸ‘ æ”¶åˆ°çš„è®šæ•¸ï¼š</strong> {{ eval_data.likes or 0 }}</p>
            <p><strong>ğŸ‘ æ”¶åˆ°çš„å€’è®šæ•¸ï¼š</strong> {{ eval_data.dislikes or 0 }}</p>
        </div>

    </div>

    <script src="{{ url_for('static', filename='js/profile.js') }}"></script>
</body>
</html>